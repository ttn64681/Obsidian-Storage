```table-of-contents
```

- first-cut data path does an instruction in one clock cycle
	- Each datapath element can only do one function at a time
	- Hence, we need separate instruction and data memories
- Use multiplexers where alternate data sources are used for different instructions

# R-Type/Load/Store Datapath
- R Type, Load, and Store instructions
![[rtype-load-store-datapath.png]]

## Animating Datapath: R-Type Instruction
![[Animate Datapath R-type.png]]
- **there IS STILL A SIGNAL to the Data Memory**, but control unit is saying to discard it.
- Control the control signal
## Animating Datapath: Load Instruction
![[Animate Datapath Load.png]]

## Animating Datapath: Store Instruction
![[Animate Datapath Store.png]]

- 1 cycle does one type of instruction, then next cycle can do a different
- all signals are still there, but we control the control signal for which ones to be used
- this is how we use the same datapath to control different instructions

# Adding Instruction Fetch
![[Adding Instruction Fetch.png]]
L1: Cache closest to cpu, instruction and data memory are separated, allowing concurrency

# Adding Branch Capability and Another Multiplexor
![[Adding Branch Capability and Another Multiplexor.png]]

## Datapath Executing Add
![[Datapath Executing Add.png]]
## Datapath Executing Load
![[Datapath Executing Load.png]]
## Datapath Executing SW
![[Datapath Executing SW.png]]
## Datapath Executing BEQ
![[Datapath Executing BEQ.png]]
## Full Datapath
![[Full Datapath.png]]

## Effect of Each of the 7 Control Signals
![[Effects of 7 Control Signals Table.png]]

## Setting of the Control Lines
![[Setting of Control Lines Table.png]]

The `ALUSrc` mux is essential for the datapath to be flexible. It allows the single ALU to be used for different purposes based on the instruction type:

- For R-Type, it takes two register values to perform arithmetic logical operations on 2 reg vals
- For I-Type (like Load/Store), it takes a register value and an immediate value to calc memory addr for load/store, or any operation involving an immediate

# ALU Control
- ALU used for
	- Load/Store: F = add
	- Branch: F = subtract
	- R-Type: F depends on funct field
- **ALU Control unit responisble for generating specific 3-bit or 4-bit control signal**
	- **tells ALU EXACTLY which operation to execute for current instruction**
![[ALU Control and Function Table.png]]

## ALU Control (Comprehensive)
- for load instruction, ALU has to do the addition to calculate address
![[ALU Control op code ALUOp Operation funct ALU function ALU control Table.png]]
- ALU Control unit typically takes 2 main inputs:
	1. ALUOp (2-bit) - generated by main Control Unit based on instruction's opcode
		- tells ALU Control unit TYPE of instruction 
			- R-type, Load/Store, Branch
	2. funct (6-bit) -  for R-type instructions, it specifies precise arithmetic or logical operation
		- add, sub, and, or, slt
		`
# The Main Control Unit
- Control signals derived from instruction
![[Main Control Unit.png]]

# Datapath with Control
![[Datapath w Control.png]]

## Datapath with Control: R-Type Instruction
![[R-Type Instruction.png]]
## Datapath with Control: Load Instruction
## ![[Load Instruction.png]]
## Datapath with Control: ![[Branch-on-equal instruction.png]]
# Overall
- **Everything is always calculated:** Many components, like the PC+4 adder, branch target adder, ALU, and Register File read ports, are **always active** and performing their computations in parallel during each clock cycle.
- **You choose which one to use:** The results of these parallel computations are fed into **multiplexers**. The **Control Unit** generates control signals (like `PCSource`, `ALUSrc`, `MemToReg`, `RegWrite`, `MemRead`, `MemWrite`) that direct these multiplexers to select the _correct_ result to propagate further in the datapath, or enable/disable writing to registers or memory.

- This is not